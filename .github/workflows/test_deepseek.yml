name: Test DeepSeek API Connection

on:
  workflow_dispatch:  # ä»…æ‰‹åŠ¨è§¦å‘

jobs:
  test-api:
    runs-on: ubuntu-latest
    steps:
    - name: Test DeepSeek API
      env:
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
      run: |
        echo "ğŸ” æµ‹è¯• DeepSeek API è¿é€šæ€§..."
        echo "æ—¶é—´: $(TZ=Asia/Shanghai date)"
        
        # å‘é€ä¸€ä¸ªæç®€è¯·æ±‚
        response=$(curl -s -w "\n%{http_code}" --max-time 120 \
          -H "Content-Type: application/json" \
          -H "Authorization: Bearer $DEEPSEEK_API_KEY" \
          -d '{
            "model": "deepseek-chat",
            "messages": [{"role": "user", "content": "Say OK"}],
            "max_tokens": 10,
            "stream": false
          }' \
          https://api.deepseek.com/v1/chat/completions)
        
        http_code=$(echo "$response" | tail -n1)
        body=$(echo "$response" | sed '$d')
        
        echo "ğŸ“¡ HTTP çŠ¶æ€ç : $http_code"
        echo "ğŸ“¦ å“åº”å†…å®¹:"
        echo "$body" | head -c 500
        
        if [ "$http_code" = "200" ]; then
          echo ""
          echo "âœ… DeepSeek API è¿æ¥æ­£å¸¸!"
        else
          echo ""
          echo "âŒ DeepSeek API å¼‚å¸¸!"
          exit 1
        fi
