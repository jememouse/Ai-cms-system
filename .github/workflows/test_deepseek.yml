name: Test DeepSeek API Connection

on:
  workflow_dispatch:  # ä»…æ‰‹åŠ¨è§¦å‘

jobs:
  test-api:
    runs-on: ubuntu-latest
    steps:
    - name: Test OpenRouter API (via DeepSeek)
      env:
        OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
      run: |
        echo "ğŸ” æµ‹è¯• OpenRouter API è¿é€šæ€§..."
        echo "æ—¶é—´: $(TZ=Asia/Shanghai date)"
        
        # å‘é€ä¸€ä¸ªæç®€è¯·æ±‚
        response=$(curl -s -w "\n%{http_code}" --max-time 120 \
          -H "Content-Type: application/json" \
          -H "Authorization: Bearer $OPENROUTER_API_KEY" \
          -H "HTTP-Referer: https://heyijiapack.com" \
          -H "X-Title: HeYiJia Test" \
          -d '{
            "model": "google/gemini-2.0-flash-exp:free",
            "messages": [{"role": "user", "content": "Say OK"}],
            "max_tokens": 10,
            "stream": false
          }' \
          https://openrouter.ai/api/v1/chat/completions)
        
        http_code=$(echo "$response" | tail -n1)
        body=$(echo "$response" | sed '$d')
        
        echo "ğŸ“¡ HTTP çŠ¶æ€ç : $http_code"
        echo "ğŸ“¦ å“åº”å†…å®¹:"
        echo "$body" | head -c 500
        
        if [ "$http_code" = "200" ]; then
          echo ""
          echo "âœ… OpenRouter API è¿æ¥æ­£å¸¸!"
        else
          echo ""
          echo "âŒ OpenRouter API å¼‚å¸¸!"
          exit 1
        fi

