name: Step2 - AI æ–‡ç« ç”Ÿæˆ

on:
  schedule:
    # åŒ—äº¬æ—¶é—´ 00:00, 04:00 (å‡Œæ™¨æ—¶æ®µï¼Œé—´éš”4å°æ—¶é¿å…å¹¶è¡Œ) -> UTC 16:00, 20:00 (å‰ä¸€å¤©)
    - cron: '0 16,20 * * *'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  step2-article:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        category: ["ä¸“ä¸šçŸ¥è¯†", "è¡Œä¸šèµ„è®¯", "äº§å“ä»‹ç»"]
      max-parallel: 1  # ğŸ”§ ä¸²è¡Œæ‰§è¡Œï¼Œé¿å…å¹¶å‘å¯¼è‡´ç½‘ç»œæ‹¥å¡
      fail-fast: false
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install uv
      uses: astral-sh/setup-uv@v5
      with:
        enable-cache: true

    - name: Install dependencies
      run: uv sync

    - name: Run Step2 - AI æ–‡ç« ç”Ÿæˆ (${{ matrix.category }})
      env:
        OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        FEISHU_APP_ID: ${{ secrets.FEISHU_APP_ID }}
        FEISHU_APP_SECRET: ${{ secrets.FEISHU_APP_SECRET }}
        FEISHU_BASE_ID: ${{ secrets.FEISHU_BASE_ID }}
        FEISHU_TABLE_ID: ${{ secrets.FEISHU_TABLE_ID }}
        MAX_GENERATE_PER_CATEGORY: '34'
        TARGET_CATEGORY: ${{ matrix.category }}
        TZ: 'Asia/Shanghai'
      run: |
        uv run python -m step2_article.runner
