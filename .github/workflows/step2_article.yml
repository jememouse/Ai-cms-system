name: Step2 - AI 文章生成

on:
  schedule:
    # 北京时间 00:10 -> UTC 16:10 (前一天)
    - cron: '10 16 * * *'
  workflow_dispatch:  # 允许手动触发

jobs:
  step2-article:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install uv
      uses: astral-sh/setup-uv@v5
      with:
        enable-cache: true

    - name: Install dependencies
      run: uv sync

    - name: Run Step2 - AI 文章生成 (按时间顺序处理所有文章)
      env:
        # 使用国内 DeepSeek 直连 API
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        FEISHU_APP_ID: ${{ secrets.FEISHU_APP_ID }}
        FEISHU_APP_SECRET: ${{ secrets.FEISHU_APP_SECRET }}
        FEISHU_BASE_ID: ${{ secrets.FEISHU_BASE_ID }}
        FEISHU_TABLE_ID: ${{ secrets.FEISHU_TABLE_ID }}
        MAX_GENERATE_PER_CATEGORY: '1000'  # 处理所有 Ready 记录
        TZ: 'Asia/Shanghai'
      run: |
        uv run python -m step2_article.runner
