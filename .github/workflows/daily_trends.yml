name: Daily Trends Automation

on:
  schedule:
    # 对应北京时间 07:00, 09:00, 11:00, 13:00 (UTC+8) -> UTC 23:00, 01:00, 03:00, 05:00
    # 注意: GitHub Actions 定时任务可能有延迟
    - cron: '0 23,1,3,5 * * *'
  workflow_dispatch:  # 允许手动触发

jobs:
  run-automation:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.9'
        cache: 'pip' # 缓存 pip 依赖
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
        
    - name: Run Automation Task
      env:
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        FEISHU_APP_ID: ${{ secrets.FEISHU_APP_ID }}
        FEISHU_APP_SECRET: ${{ secrets.FEISHU_APP_SECRET }}
        # 如果 Base ID 和 Table ID 经常变，建议也设为 Secrets，或者在此处硬编码/使用 Vars
        FEISHU_BASE_ID: ${{ secrets.FEISHU_BASE_ID || 'ROVGbzfTfaEGjosDkxHck65Cnmx' }}
        FEISHU_TABLE_ID: ${{ secrets.FEISHU_TABLE_ID || 'tblxkLHxg9K3uHyp' }}
        TZ: 'Asia/Shanghai'
      run: |
        # 直接调用 main_scheduler 中的 job 函数执行一次
        python -c "from main_scheduler import job; job()"
