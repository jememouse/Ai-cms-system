name: Daily Trends Automation

on:
  schedule:
    # 北京时间 01:00, 03:00, 05:00, 07:00 (UTC+8) -> UTC 17:00, 19:00, 21:00, 23:00
    - cron: '0 17,19,21,23 * * *'
  workflow_dispatch:  # 允许手动触发

jobs:
  run-automation:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    # 使用官方 setup-uv Action
    - name: Install uv
      uses: astral-sh/setup-uv@v5
      with:
        enable-cache: true  # 启用缓存加速后续构建

    # uv 会自动安装 Python 并同步依赖
    - name: Install dependencies
      run: uv sync

    - name: Run Automation Task
      env:
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        FEISHU_APP_ID: ${{ secrets.FEISHU_APP_ID }}
        FEISHU_APP_SECRET: ${{ secrets.FEISHU_APP_SECRET }}
        FEISHU_BASE_ID: ${{ secrets.FEISHU_BASE_ID || 'ROVGbzfTfaEGjosDkxHck65Cnmx' }}
        FEISHU_TABLE_ID: ${{ secrets.FEISHU_TABLE_ID || 'tblxkLHxg9K3uHyp' }}
        TZ: 'Asia/Shanghai'
      run: |
        # 使用 uv run 执行任务
        uv run python -c "from main_scheduler import job; job()"
